# playwright-playground — Playwright tests

## Important notes

This repository contains Playwright tests for the Conduit demo app (https://conduit.bondaracademy.com/). Below are concise, practical notes to run, debug, and generate reports from this test suite.

1. Quick run and helpful npm scripts
    - Run regression (uses `regression` project):
      npx playwright test --project=regression
    - Provided npm scripts (from `package.json`):
        - `npm run conduit-smoke` — runs `--project=regression` and greps `@smoke` tests.
        - `npm run conduit-regression` — runs tests under `tests/conduit` with `regression` project.
        - `npm run conduit-like-counter` — runs the `likeCounter` project tests.
        - `npm run conduit-like-counter-global` — runs the `likeCounterGlobal` project tests.
        - `npm run format` — runs Prettier to format files.
        - `npm run allure:generate` — generate Allure report from `./allure-results` to `./allure-report`.
        - `npm run allure:open` — open previously generated Allure report.

2. Playwright configuration highlights (`playwright.config.ts`)
    - Tests live in `./tests` and Playwright is configured for parallel execution.
    - Reporters configured: JSON (`test-results/results.json`), JUnit (`test-results/results.xml`), and `allure-playwright`.
    - Default baseURL: `https://conduit.bondaracademy.com/` (used by tests/pages/helpers).
    - Tests use a `storageState` file at `auth/conduit-user.json`. Global setup writes to this file.
    - `ACCESS_TOKEN` environment variable is set at runtime by the global setup for API helpers.
    - Headed mode defaults to `headless: false` in config. CI behavior is controlled by `process.env.CI`.

3. Authentication & storage-state
    - Credentials are read from environment variables `CONDUIT_EMAIL` and `CONDUIT_PASSWORD` (preferred for CI).
    - If env vars are not set, the global setup will attempt to read `auth/conduit-credentials.json` (this file is gitignored in the project and used for local runs).
    - The global setup logs in via the API and writes the Playwright storage state to `auth/conduit-user.json`.
    - If you need to run a single test without running global setup, ensure `auth/conduit-user.json` exists and contains a valid jwtToken for `https://conduit.bondaracademy.com`.

4. Test projects and lifecycle
    - Projects configured in `playwright.config.ts` include `setup`, `articleSetup`, `articleCleanUp`, `regression`, `likeCounter`, `likeCounterGlobal`, and `mobile` (iPhone device emulation).
    - `setup` is used to create the storage state. `articleSetup` creates a test article and has a teardown dependency `articleCleanUp` that deletes it.
    - Global setup (configured via `globalSetup`) creates the storage state and a global test article used by like-counter tests. Global teardown deletes the article.

5. Reports, artifacts and troubleshooting
    - Allure results: `./allure-results` (contains attachments and test case JSON). Generate/open with the npm scripts above.
    - Playwright HTML report: `./playwright-report/index.html` (generated by Playwright when you run the HTML reporter manually). Use `npx playwright show-report` to open the last run report.
    - Screenshots are saved under `./screenshots/` (organized by test / project folder).
    - If you see failing tests that depend on authentication, re-run global setup or delete `auth/conduit-user.json` and run the `setup` project:
      npx playwright test --project=setup

6. Environment variables useful for local and CI runs
    - CONDUIT_EMAIL and CONDUIT_PASSWORD — user credentials for login.
    - ACCESS_TOKEN — set by global setup; used by helpers and Playwright extraHTTPHeaders.
    - BASE_API — override API base endpoint used by ApiHelper (defaults to `https://conduit-api.bondaracademy.com/api`).

7. Developer tips
    - Use `--grep` or `--project` to limit runs when iterating locally.
    - Use Playwright trace & video options (configured) to debug flaky tests: traces are kept on first retry and videos retained on failure.
    - Format TypeScript with `npm run format` to keep code style consistent.

8. Safety and gitignored files
    - `auth/conduit-credentials.json` and `auth/conduit-user.json` are expected to be gitignored. Do not check in real credentials or tokens.

If you'd like, I can also:

- Add a short `Makefile` or npm script to run common flows (e.g., `setup-and-regression`).
- Create a small CONTRIBUTING section describing how to add tests and run them in CI.

## Completion summary

I inspected the repository configuration and tests, and added the above important notes to this `README.md`. Next steps: optionally validate run commands by executing a lightweight Playwright command or add developer convenience scripts.
